Основные возможности:
- Шифрованная запись видео с использованием ключей X25519
- Фоновая запись без UI
- Поддержка различных режимов: день, ночь, фронтальная камера
- Разрешения: HD (1280x720), FHD (1920x1080), 2K (2560x1440), 4K (3840x2160)
- Кодеки: AVC (H.264), HEVC (H.265)
- Управление ключами: импорт, экспорт, сканирование QR кодов
- Выбор выходной директории для сохранения файлов
- Настройки камеры и записи
- Управление через ADB команды
- Плитка быстрого доступа в настройках
- Виброотклики и уведомления
- Режим фото с шифрованием
- Наложение на экран для индикации шифрования
- Кастомизация уведомлений для маскировки записи
- Управление громкостью для запуска/остановки записи
- Удаление EXIF данных из фото
- Запоминание режима съемки (фото/видео)
- Ручная настройка ID камер для каждого режима
- Список доступных камер на устройстве
- Настройка шаблона имени файла

Команды ADB и их настройка:

Запуск записи:
adb shell am start -a com.android.system.action.START_SERVICE -n com.tnibler.system/.StartReceiverActivity --es mode day --es res FHD --es codec AVC -f 0x10008000

Параметры:
- mode: day, night, front
- res: HD, FHD, 2K, 4K
- codec: AVC, HEVC
- -f 0x10008000: флаг для запуска в фоне (лучше его использовать всегда)

Остановка записи:
adb shell am start -a com.android.system.action.STOP_SERVICE -n com.tnibler.system/.StartReceiverActivity -f 0x10008000

Открыть настройки:
adb shell am start -a com.android.system.action.OPEN_SETTINGS -n com.tnibler.system/.MainActivity -f 0x10008000

Открыть управление ключами:
adb shell am start -a com.android.system.action.OPEN_KEYS -n com.tnibler.system/.MainActivity -f 0x10008000

Открыть выбор выходной папки:
adb shell am start -a com.android.system.action.PICK_OUTPUT -n com.tnibler.system/.MainActivity -f 0x10008000

Проверка ключа шифрования:
adb shell am start -a com.android.system.action.CHECK_KEY -n com.tnibler.system/.MainActivity -f 0x10008000

Удаления программы:
adb uninstall com.tnibler.system

Обработка разрешений:

При первом запуске записи приложение запрашивает разрешения на камеру, микрофон и уведомления.
Если разрешения отклонены, появляется диалог PermissionRationaleActivity с объяснением необходимости разрешений и кнопкой "Перейти в настройки" для ручного включения в системных настройках Android.
Без разрешений запись невозможна.

Настройки приложения:

Страница настроек доступна через меню или ADB команду.
Основные разделы:

1. Выходная директория: Выбор папки для сохранения файлов. Обязательно для работы.
2. Шаблон имени файла: Настройка формата имен файлов с переменными ($uuid, $year, $month, $day, $hour, $min, $sec, $num). Лучше не менять во избежания поломки функциональности разных имён файлов при записи и записанных.
3. Ручная настройка ID камер: Опционально, ручной выбор ID камер для каждого режима (день, ночь, фронт). Оставьте пустым для автоопределения.
4. Список доступных камер: Информация о всех камерах на устройстве с их характеристиками для ручной настройки.
5. Кастомизация уведомлений: Настройка заголовка, текста и иконки уведомления для маскировки фоновой записи.
6. Поведение: Настройки вибрации (при старте, остановке, во время записи каждые 5 секунд).
7. Ключи: Управление ключами шифрования X25519.

Инструкция по использованию:

1. Установка и первое использование:
   - Установите APK приложения
   - При первом запуске выберите ключ шифрования (запустив команду запуска записи или открыв настройки)
   - Выберите выходную директорию для сохранения файлов (запустив команду запуска записи или открыв настройки)
   - Предоставьте разрешения на камеру, микрофон и уведомления (запустив команду запуска записи или открыв камеру для сканирования qr)

2. Управление ключами:
   - В разделе "Ключи" можно добавить новые ключи через импорт или сканирование QR
   - Выберите активные ключи для шифрования
   - Можно редактировать имена ключей, удалять неиспользуемые

3. Запись видео:
   - Запустите команду START_SERVICE
   - Запись идет в фоне, показывается уведомление с таймером
   - Команда STOP_SERVICE останавливает запись
   - Файлы сохраняются в выбранную директорию с шифрованием

4. Использование ADB:
   - Подключите устройство к ПК с ADB
   - Используйте команды выше для автоматизации записи
   - Можно интегрировать в скрипты для автоматической записи

5. Расшифровка файлов:
   - Файлы имеют расширение .age
   - Для расшифровки используйте age инструмент с соответствующим ключом (программа для этого есть в репозитории https://gitlab.com/cryptocam/cryptocam )
   - age --decrypt -i private_key.txt encrypted_file.age (это команда, но проще использовать UI программы)

6. Обработка нехватки памяти:
    - Корректная остановка записи при нехватке места с сохранением файла

Дополнительные возможности:
- Автоматическое переключение камер
- Настройка битрейта (в коде) и FPS

Нюансы:
- В некоторых случаях (при дублировании файла или после переустановки приложения) получается так что у файла имя, например, "cryptocam_0001 (1).age". Этот пробел не даст запихнуть файл в программу расшифрования. Решением является удаление этого пробела.





## Настройка битрейта видео и аудио

Битрейт (скорость потока данных) влияет на качество и размер файла. В приложении битрейт настраивается автоматически в зависимости от разрешения, но можно изменить его вручную в коде.

### Автоматические настройки битрейта по разрешению:

- **HD (1280x720)**: 15 Мбит/с
- **FHD (1920x1080)**: 25 Мбит/с
- **2K (2560x1440)**: 40 Мбит/с
- **4K (3840x2160)**: 60 Мбит/с

### Как изменить битрейт:

1. Откройте файл `app/src/main/java/com/tnibler/system/video/RecordingService.kt`
2. Найдите функцию `setupVideoCapture()` (примерно строка 280)
3. В блоке настройки битрейта измените значения:


val initialBitRate = when {
    params.resolution.width >= 3840 -> 60_000_000  // 4K: 60 Мбит/с
    params.resolution.width >= 2560 -> 40_000_000  // 2K: 40 Мбит/с
    params.resolution.width >= 1920 -> 25_000_000  // FHD: 25 Мбит/с
    else -> 15_000_000  // HD: 15 Мбит/с
}


### Рекомендации по битрейту:

- **Высокий битрейт** (больше Мбит/с): лучшее качество, но файлы больше
- **Низкий битрейт** (меньше Мбит/с): файлы меньше, но качество хуже
- Для **AVC (H.264)**: можно использовать на 20-30% меньше битрейт чем для HEVC
- Для **HEVC (H.265)**: эффективнее сжимает, можно снизить битрейт для того же качества

### Настройка соотношения битрейта HEVC к AVC:

По умолчанию битрейт для HEVC уменьшен на 40% относительно битрейта для AVC. Это сделано для оптимизации размера файлов при сохранении хорошего качества.

**Как изменить процент уменьшения битрейта HEVC:**

1. Откройте файл `app/src/main/java/com/tnibler/system/video/RecordingService.kt`
2. Найдите переменную `HEVC_BITRATE_REDUCTION_PERCENT` (примерно строка 30)
3. Измените значение (по умолчанию 40):


private val HEVC_BITRATE_REDUCTION_PERCENT = 40  // Измените на нужное значение


**Примеры:**
- `HEVC_BITRATE_REDUCTION_PERCENT = 0` - HEVC использует тот же битрейт, что и AVC
- `HEVC_BITRATE_REDUCTION_PERCENT = 20` - HEVC использует 80% от битрейта AVC
- `HEVC_BITRATE_REDUCTION_PERCENT = 50` - HEVC использует 50% от битрейта AVC


### Аудио битрейт:

Аудио битрейт фиксирован на 256 Кбит/с (2 канала, 48 кГц). Изменить можно в том же файле:


.setAudioBitRate(256000)  // 256 Кбит/с
.setAudioSampleRate(48000) // 48 кГц
.setAudioChannelCount(2)   // Стерео
